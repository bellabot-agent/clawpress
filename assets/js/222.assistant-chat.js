"use strict";(self.webpackChunkclawpress_chat_ui=self.webpackChunkclawpress_chat_ui||[]).push([[222],{4222(t,n,e){e.r(n),e.d(n,{parseIncompleteMarkdown:()=>g});const r=/(!?\[)([^\]]*?)$/,s=/(\*\*)([^*]*?)$/,i=/(__)([^_]*?)$/,u=/(\*\*\*)([^*]*?)$/,c=/(\*)([^*]*?)$/,f=/(_)([^_]*?)$/,l=/(`)([^`]*?)$/,o=/(~~)([^~]*?)$/,$=t=>{const n=(t.match(/```/g)||[]).length;return n>0&&n%2==0&&t.includes("\n")},h=(t,n)=>{let e=!1,r=!1;for(let s=0;s<t.length&&s<n;s++)"\\"!==t[s]||"$"!==t[s+1]?"$"===t[s]&&("$"===t[s+1]?(r=!r,s++,e=!1):r||(e=!e)):s++;return e||r},a=(t,n)=>{const e="```"===t.substring(n,n+3),r=n>0&&"```"===t.substring(n-1,n+2),s=n>1&&"```"===t.substring(n-2,n+1);return e||r||s},g=t=>{if(!t||"string"!=typeof t)return t;let n=t;const e=(t=>{const n=t.match(r);if(n){if(n[1].startsWith("!")){const e=t.lastIndexOf(n[1]);return t.substring(0,e)}return`${t}](agenttic:incomplete-link)`}return t})(n);return e.endsWith("](agenttic:incomplete-link)")?e:(n=e,n=(t=>{if($(t)||/^\*{4,}$/.test(t))return t;const n=t.match(u);if(n){const e=n[2];if(!e||/^[\s_~*`]*$/.test(e))return t;if((t=>{let n=0;const e=t.match(/\*+/g)||[];for(const t of e){const e=t.length;e>=3&&(n+=Math.floor(e/3))}return n})(t)%2==1)return`${t}***`}return t})(n),n=(t=>{if($(t))return t;const n=t.match(s);if(n){const e=n[2];if(!e||/^[\s_~*`]*$/.test(e))return t;const r=t.lastIndexOf(n[1]),s=t.substring(0,r).lastIndexOf("\n"),i=-1===s?0:s+1,u=t.substring(i,r);if(/^[\s]*[-*+][\s]+$/.test(u)&&e.includes("\n"))return t;if((t.match(/\*\*/g)||[]).length%2==1)return`${t}**`}return t})(n),n=(t=>{const n=t.match(i);if(n){const e=n[2];if(!e||/^[\s_~*`]*$/.test(e))return t;const r=t.lastIndexOf(n[1]),s=t.substring(0,r).lastIndexOf("\n"),i=-1===s?0:s+1,u=t.substring(i,r);if(/^[\s]*[-*+][\s]+$/.test(u)&&e.includes("\n"))return t;if((t.match(/__/g)||[]).length%2==1)return`${t}__`}return t})(n),n=(t=>{if($(t))return t;if(t.match(c)){let n=-1;for(let e=0;e<t.length;e++)if("*"===t[e]&&"*"!==t[e-1]&&"*"!==t[e+1]){n=e;break}if(-1===n)return t;const e=t.substring(n+1);if(!e||/^[\s_~*`]*$/.test(e))return t;if((t=>t.split("").reduce((n,e,r)=>{if("*"===e){const e=t[r-1],s=t[r+1];if("\\"===e)return n;let i=r;for(let n=r-1;n>=0;n--){if("\n"===t[n]){i=n+1;break}if(0===n){i=0;break}}if(""===t.substring(i,r).trim()&&(" "===s||"\t"===s))return n;if("*"!==e&&"*"!==s)return n+1}return n},0))(t)%2==1)return`${t}*`}return t})(n),n=(t=>{if($(t))return t;if(t.match(f)){let n=-1;for(let e=0;e<t.length;e++)if("_"===t[e]&&"_"!==t[e-1]&&"_"!==t[e+1]&&"\\"!==t[e-1]&&!h(t,e)){const r=e>0?t[e-1]:"",s=e<t.length-1?t[e+1]:"";if(r&&s&&/[\p{L}\p{N}_]/u.test(r)&&/[\p{L}\p{N}_]/u.test(s))continue;n=e;break}if(-1===n)return t;const e=t.substring(n+1);if(!e||/^[\s_~*`]*$/.test(e))return t;if((t=>t.split("").reduce((n,e,r)=>{if("_"===e){const e=t[r-1],s=t[r+1];if("\\"===e||h(t,r)||e&&s&&/[\p{L}\p{N}_]/u.test(e)&&/[\p{L}\p{N}_]/u.test(s))return n;if("_"!==e&&"_"!==s)return n+1}return n},0))(t)%2==1){const n=t.match(/\n+$/);return n?`${t.slice(0,-n[0].length)}_${n[0]}`:`${t}_`}}return t})(n),n=(t=>{if(t.match(/^```[^`\n]*```?$/)&&!t.includes("\n"))return t.endsWith("``")&&!t.endsWith("```")?`${t}\``:t;const n=(t.match(/```/g)||[]).length,e=n%2==1;if(n>0&&n%2==0&&t.includes("\n")||(t.endsWith("```\n")||t.endsWith("```"))&&n%2==0)return t;const r=t.match(l);if(r&&!e){const n=r[2];if(!n||/^[\s_~*`]*$/.test(n))return t;if((t=>{let n=0;for(let e=0;e<t.length;e++)"`"===t[e]&&!a(t,e)&&n++;return n})(t)%2==1)return`${t}\``}return t})(n),n=(t=>{const n=t.match(o);if(n){const e=n[2];if(!e||/^[\s_~*`]*$/.test(e))return t;if((t.match(/~~/g)||[]).length%2==1)return`${t}~~`}return t})(n),n=(t=>{if((t.match(/\$\$/g)||[]).length%2==0)return t;const n=t.indexOf("$$");return-1===n||-1===t.indexOf("\n",n)||t.endsWith("\n")?`${t}$$`:`${t}\n$$`})(n),n)}}}]);